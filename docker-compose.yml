version: "3.8"

services:
  # ===========================================
  # PocketBase Server + PWA
  # ===========================================
  pocketbase:
    image: ghcr.io/muchobien/pocketbase:latest
    container_name: notice-server
    restart: unless-stopped
    ports:
      - "${PORT:-8090}:8090"
    volumes:
      - ./pb_data:/pb_data
      - ./pb_hooks:/pb_hooks
      - ./pb_public:/pb_public
    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN:-}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID:-}
      - REGION_NAME=${REGION_NAME:-}
      - REGION_LAT=${REGION_LAT:-}
      - REGION_LONG=${REGION_LONG:-}
      - REGION_ZOOM=${REGION_ZOOM:-14}
    command: serve --http=0.0.0.0:8090

  # ===========================================
  # Cloudflare Tunnel (Optional)
  # Gives you a free public HTTPS URL instantly
  # ===========================================
  tunnel:
    image: cloudflare/cloudflared:latest
    container_name: notice-tunnel
    restart: unless-stopped
    command: tunnel --no-autoupdate --url http://pocketbase:8090
    depends_on:
      - pocketbase
    profiles:
      - public  # Only starts with: docker compose --profile public up
