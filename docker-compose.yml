# notICE - Community Safety Alert System
# Docker Compose configuration
#
# Quick Start:
#   docker compose up -d
#
# With Cloudflare Tunnel (free HTTPS):
#   docker compose --profile public up -d
#

services:
  # ===========================================
  # notICE Server + PWA
  # ===========================================
  notice:
    image: ghcr.io/adriancmurray/notice:latest
    container_name: notice-server
    restart: unless-stopped
    ports:
      - "${PORT:-8090}:8090"
    volumes:
      - notice-data:/app/pb_data
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:8090/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # ===========================================
  # Cloudflare Tunnel (Optional)
  # Gives you a free public HTTPS URL instantly
  # ===========================================
  tunnel:
    image: cloudflare/cloudflared:latest
    container_name: notice-tunnel
    restart: unless-stopped
    command: tunnel --no-autoupdate --url http://notice:8090
    depends_on:
      - notice
    profiles:
      - public  # Only starts with: docker compose --profile public up

volumes:
  notice-data:
